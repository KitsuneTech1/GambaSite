const caseData = [
    {
        id: "fever",
        name: "Fever Case",
        price: 0.71,
        image: "https://cdn.csgoskins.gg/public/uih/items/aHR0cHM6Ly9jZG4uY3Nnb3NraW5zLmdnL3B1YmxpYy9pbWFnZXMvYnVja2V0cy9lY29uL3dlYXBvbl9jYXNlcy9jcmF0ZV9jb21tdW5pdHlfMzUuOTk1ODUxZTE0ZDgzNmIyM2JkOWMxZDk1MWVjOGI3NTEyNjczNzg3ZC5wbmc-/auto/auto/85/notrim/9b60495f254538d517f5c7eca85d87f4.webp",
        drops: [
            { name: "Rare Item", image: "https://via.placeholder.com/50x30/ff00ff/ffffff?text=Rare", odds: 0.002, value: 100.00, rarity: "rare" },
            { name: "Legendary Item", image: "https://via.placeholder.com/50x30/ff4500/ffffff?text=Legend", odds: 0.008, value: 50.00, rarity: "legendary" },
            { name: "Epic Item", image: "https://via.placeholder.com/50x30/ffa500/ffffff?text=Epic", odds: 0.01, value: 30.00, rarity: "epic" },
            { name: "Mythical Item", image: "https://via.placeholder.com/50x30/ff8c00/ffffff?text=Mythic", odds: 0.015, value: 20.00, rarity: "mythical" },
            { name: "Very Rare Item", image: "https://via.placeholder.com/50x30/ffd700/ffffff?text=V.Rare", odds: 0.02, value: 10.00, rarity: "very-rare" },
            { name: "Rare Skin", image: "https://via.placeholder.com/50x30/ffff00/ffffff?text=RareS", odds: 0.05, value: 5.00, rarity: "rare-skin" },
            { name: "Uncommon Skin", image: "https://via.placeholder.com/50x30/adff2f/ffffff?text=UncomS", odds: 0.07, value: 2.00, rarity: "uncommon-skin" },
            { name: "Common Skin", image: "https://via.placeholder.com/50x30/808080/ffffff?text=CommonS", odds: 0.875, value: 0.10, rarity: "common-skin" }
        ]
    },
    {
        id: "dreams-nightmares",
        name: "Dreams & Nightmares Case",
        price: 0.45,
        image: "https://cdn.csgoskins.gg/public/uih/items/aHR0cHM6Ly9jZG4uY3Nnb3NraW5zLmdnL3B1YmxpYy9pbWFnZXMvYnVja2V0cy9lY29uL3dlYXBvbl9jYXNlcy9jcmF0ZV9jb21tdW5pdHlfMzAuYzQ3MWEzZjc0YTI1NGM4MDc1NGY3ZGVlYzE5YWRhZjBkZjI2NmUyMy5wbmc-/auto/auto/85/notrim/21beb54cd2ee10122a102cbc870ee3e5.webp",
        drops: [
            { name: "Rare Item", image: "https://via.placeholder.com/50x30/ff00ff/ffffff?text=Rare", odds: 0.002, value: 100.00, rarity: "rare" },
            { name: "Legendary Item", image: "https://via.placeholder.com/50x30/ff4500/ffffff?text=Legend", odds: 0.008, value: 50.00, rarity: "legendary" },
            { name: "Epic Item", image: "https://via.placeholder.com/50x30/ffa500/ffffff?text=Epic", odds: 0.01, value: 30.00, rarity: "epic" },
            { name: "Mythical Item", image: "https://via.placeholder.com/50x30/ff8c00/ffffff?text=Mythic", odds: 0.015, value: 20.00, rarity: "mythical" },
            { name: "Very Rare Item", image: "https://via.placeholder.com/50x30/ffd700/ffffff?text=V.Rare", odds: 0.02, value: 10.00, rarity: "very-rare" },
            { name: "Rare Skin", image: "https://via.placeholder.com/50x30/ffff00/ffffff?text=RareS", odds: 0.05, value: 5.00, rarity: "rare-skin" },
            { name: "Uncommon Skin", image: "https://via.placeholder.com/50x30/adff2f/ffffff?text=UncomS", odds: 0.07, value: 2.00, rarity: "uncommon-skin" },
            { name: "Common Skin", image: "https://via.placeholder.com/50x30/808080/ffffff?text=CommonS", odds: 0.875, value: 0.10, rarity: "common-skin" }
        ]
    },
    {
        id: "fracture",
        name: "Fracture Case",
        price: 0.42,
        image: "https://cdn.csgoskins.gg/public/uih/items/aHR0cHM6Ly9jZG4uY3Nnb3NraW5zLmdnL3B1YmxpYy9pbWFnZXMvYnVja2V0cy9lY29uL3dlYXBvbl9jYXNlcy9jcmF0ZV9jb21tdW5pdHlfMjYuYjI1MDk4YWY1YTQyODUwMDQwNTI3ODZlMjYxYmU0M2RlYzViODljZi5wbmc-/auto/auto/85/notrim/7130235e21e92d11f1ea81fa677cf379.webp",
        drops: [
            { name: "Rare Item", image: "https://via.placeholder.com/50x30/ff00ff/ffffff?text=Rare", odds: 0.002, value: 100.00, rarity: "rare" },
            { name: "Legendary Item", image: "https://via.placeholder.com/50x30/ff4500/ffffff?text=Legend", odds: 0.008, value: 50.00, rarity: "legendary" },
            { name: "Epic Item", image: "https://via.placeholder.com/50x30/ffa500/ffffff?text=Epic", odds: 0.01, value: 30.00, rarity: "epic" },
            { name: "Mythical Item", image: "https://via.placeholder.com/50x30/ff8c00/ffffff?text=Mythic", odds: 0.015, value: 20.00, rarity: "mythical" },
            { name: "Very Rare Item", image: "https://via.placeholder.com/50x30/ffd700/ffffff?text=V.Rare", odds: 0.02, value: 10.00, rarity: "very-rare" },
            { name: "Rare Skin", image: "https://via.placeholder.com/50x30/ffff00/ffffff?text=RareS", odds: 0.05, value: 5.00, rarity: "rare-skin" },
            { name: "Uncommon Skin", image: "https://via.placeholder.com/50x30/adff2f/ffffff?text=UncomS", odds: 0.07, value: 2.00, rarity: "uncommon-skin" },
            { name: "Common Skin", image: "https://via.placeholder.com/50x30/808080/ffffff?text=CommonS", odds: 0.875, value: 0.10, rarity: "common-skin" }
        ]
    },
    {
        id: "operation-breakout-weapon",
        name: "Operation Breakout Weapon Case",
        price: 9.46,
        image: "https://cdn.csgoskins.gg/public/uih/items/aHR0cHM6Ly9jZG4uY3Nnb3NraW5zLmdnL3B1YmxpYy9pbWFnZXMvYnVja2V0cy9lY29uL3dlYXBvbl9jYXNlcy9jcmF0ZV9jb21tdW5pdHlfNC5mMGQyMzg0ODUyN2I3YmUwZjFmYzk1NTZiMWYzZWNmYjExOTNlZTQwLnBuZw--/auto/auto/85/notrim/bdca454652af3fa481e82915701f0470.webp",
        drops: [
            { name: "Rare Item", image: "https://via.placeholder.com/50x30/ff00ff/ffffff?text=Rare", odds: 0.002, value: 100.00, rarity: "rare" },
            { name: "Legendary Item", image: "https://via.placeholder.com/50x30/ff4500/ffffff?text=Legend", odds: 0.008, value: 50.00, rarity: "legendary" },
            { name: "Epic Item", image: "https://via.placeholder.com/50x30/ffa500/ffffff?text=Epic", odds: 0.01, value: 30.00, rarity: "epic" },
            { name: "Mythical Item", image: "https://via.placeholder.com/50x30/ff8c00/ffffff?text=Mythic", odds: 0.015, value: 20.00, rarity: "mythical" },
            { name: "Very Rare Item", image: "https://via.placeholder.com/50x30/ffd700/ffffff?text=V.Rare", odds: 0.02, value: 10.00, rarity: "very-rare" },
            { name: "Rare Skin", image: "https://via.placeholder.com/50x30/ffff00/ffffff?text=RareS", odds: 0.05, value: 5.00, rarity: "rare-skin" },
            { name: "Uncommon Skin", image: "https://via.placeholder.com/50x30/adff2f/ffffff?text=UncomS", odds: 0.07, value: 2.00, rarity: "uncommon-skin" },
            { name: "Common Skin", image: "https://via.placeholder.com/50x30/808080/ffffff?text=CommonS", odds: 0.875, value: 0.10, rarity: "common-skin" }
        ]
    },
    {
        id: "sealed-genesis-terminal",
        name: "Sealed Genesis Terminal",
        price: 0.56,
        image: "https://cdn.csgoskins.gg/public/uih/items/aHR0cHM6Ly9jZG4uY3Nnb3NraW5zLmdnL3B1YmxpYy9pbWFnZXMvYnVja2V0cy9lY29uL3dlYXBvbl9jYXNlcy9jcmF0ZV9jb21tdW5pdHlfMzZfY2xvc2VkLjVkZTNlMTA3OTA4YzJjMjFjOTUxYzZmYmY0MjM0MzllNzg4NjRjMjgucG5n-/auto/auto/85/notrim/db34dfcee586d1dcbb8b438a6293456c.webp",
        drops: [
            { name: "Rare Item", image: "https://via.placeholder.com/50x30/ff00ff/ffffff?text=Rare", odds: 0.002, value: 100.00, rarity: "rare" },
            { name: "Legendary Item", image: "https://via.placeholder.com/50x30/ff4500/ffffff?text=Legend", odds: 0.008, value: 50.00, rarity: "legendary" },
            { name: "Epic Item", image: "https://via.placeholder.com/50x30/ffa500/ffffff?text=Epic", odds: 0.01, value: 30.00, rarity: "epic" },
            { name: "Mythical Item", image: "https://via.placeholder.com/50x30/ff8c00/ffffff?text=Mythic", odds: 0.015, value: 20.00, rarity: "mythical" },
            { name: "Very Rare Item", image: "https://via.placeholder.com/50x30/ffd700/ffffff?text=V.Rare", odds: 0.02, value: 10.00, rarity: "very-rare" },
            { name: "Rare Skin", image: "https://via.placeholder.com/50x30/ffff00/ffffff?text=RareS", odds: 0.05, value: 5.00, rarity: "rare-skin" },
            { name: "Uncommon Skin", image: "https://via.placeholder.com/50x30/adff2f/ffffff?text=UncomS", odds: 0.07, value: 2.00, rarity: "uncommon-skin" },
            { name: "Common Skin", image: "https://via.placeholder.com/50x30/808080/ffffff?text=CommonS", odds: 0.875, value: 0.10, rarity: "common-skin" }
        ]
    }
];

function calculateRTP(caseObj) {
    let expectedValue = 0;
    let totalOdds = 0;
    caseObj.drops.forEach(drop => {
        expectedValue += drop.odds * drop.value;
        totalOdds += drop.odds;
    });
    // Adjust odds to ensure totalOdds is 1 and RTP is 90%
    const scaleFactor = 0.90 * caseObj.price / expectedValue;
    caseObj.drops.forEach(drop => {
        drop.odds *= scaleFactor;
    });
    // Recalculate total odds after scaling
    totalOdds = caseObj.drops.reduce((sum, drop) => sum + drop.odds, 0);
    // Normalize odds to sum to 1
    caseObj.drops.forEach(drop => {
        drop.odds /= totalOdds;
    });

    // Recalculate expected value with normalized odds
    expectedValue = caseObj.drops.reduce((sum, drop) => sum + drop.odds * drop.value, 0);
    return (expectedValue / caseObj.price * 100).toFixed(2);
}

function generateCaseCard(caseObj) {
    const rtp = calculateRTP(caseObj); // Calculate RTP for display

    const dropItemsHtml = caseObj.drops.map(drop => `
        <div class="drop-item">
            <img src="${drop.image}" alt="${drop.name}">
            <p>${drop.name}</p>
            <p class="drop-odds">${(drop.odds * 100).toFixed(2)}%</p>
        </div>
    `).join('');

    return `
        <div class="case-card" data-case-id="${caseObj.id}">
            <div class="case-header">
                <span class="case-rtp">${rtp}% RTP</span>
                <i class="fas fa-star favorite-icon"></i>
            </div>
            <img src="${caseObj.image}" alt="${caseObj.name}" class="case-image">
            <h3>${caseObj.name}</h3>
            <p class="case-price"><i class="fas fa-coins coin-icon"></i> ${caseObj.price.toFixed(2)}</p>
            <div class="case-drops-preview">
                ${dropItemsHtml}
            </div>
            <button class="open-case-btn">OPEN CASE</button>
        </div>
    `;
}

document.addEventListener('DOMContentLoaded', () => {
    const casesGrid = document.querySelector('.cases-grid');
    if (casesGrid) {
        caseData.forEach(caseObj => {
            casesGrid.insertAdjacentHTML('beforeend', generateCaseCard(caseObj));
        });
    }

    // Event listener for opening a specific case
    casesGrid.addEventListener('click', (event) => {
        const openCaseBtn = event.target.closest('.open-case-btn');
        if (openCaseBtn) {
            const caseCard = openCaseBtn.closest('.case-card');
            const caseId = caseCard.dataset.caseId;
            window.location.href = `unboxing.html?caseId=${caseId}`;
        }
    });
});
